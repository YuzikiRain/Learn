## 协程和线程

协程是轻量级的线程，协程是由程序控制而不是操作系统，同一时间只能执行一个协程，其他协程则处于休眠状态

unity的协程只发生在主线程上（因为需要一个MonoBehavior来启动，因此此时的上下文必然就是主线程），由于只能在主线程上访问Mono脚本或者Object资产，因此一般涉及这些的异步操作都会使用协程而不是新开一个线程

## 协程的实现原理

利用了c#的yield关键字将迭代器块自动构建成枚举器（以嵌套类的形式）的特性。

-   yield关键字将逻辑分成多段，每个yield之间的函数除了yield return的自定义协程之外，都是在当前帧立即执行的。
-   自定义协程只是一个空壳，不会立即执行完毕，因此之后的逻辑自然被延后了
-   Mono脚本每一帧都对枚举器执行MoveNext函数，检查yield的自定义协程类型是否已经达成条件（自定义协程类型可以自行扩展，支持复杂的条件判断），作为是否MoveNext到下一个迭代器块的条件。